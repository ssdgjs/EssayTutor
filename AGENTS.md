# PROJECT KNOWLEDGE BASE

**Generated:** 2026-02-03
**Type:** npm workspaces monorepo

## OVERVIEW

AsseyTutor - 智能英文作文批改APP. A K12 education platform with React Native mobile app (Expo), Node.js/Express backend, and shared TypeScript types. Uses 智谱AI GLM-4.5-air for essay grading and 火山引擎 OCR.

## STRUCTURE

```
asseytutor/
├── mobile/                    # React Native + Expo + TypeScript
├── server/                    # Express + TypeScript
├── shared/                    # Shared types & utilities
├── package.json               # Root workspace config
└── tsconfig.base.json         # TypeScript base config
```

## WHERE TO LOOK

| Task | Location | Notes |
|------|----------|-------|
| **Mobile UI** | `mobile/src/app/` | Expo Router file-based routing |
| **Mobile Components** | `mobile/src/components/` | Reusable UI (Button, Card, Input) |
| **Mobile State** | `mobile/src/store/` | Zustand stores (useUserStore, useEssayStore) |
| **Mobile API** | `mobile/src/services/` | Axios client with interceptors |
| **Backend API** | `server/src/routes/` | Express routers (ai.routes.ts) |
| **Backend Services** | `server/src/services/` | AI grading, OCR services |
| **Shared Types** | `shared/src/types/` | User, Essay, GradingResult, Rubric |

## CONVENTIONS

### Imports & Paths
- **Cross-package**: Use `@asseytutor/shared/*` path alias
- **Mobile local**: Relative imports for siblings, `@/` for components
- **No barrel exports** in shared (use explicit exports)

### TypeScript
- **Strict mode** enabled everywhere
- **No `any`** - use `unknown` + type narrowing
- **Interfaces** for shapes, **types** for unions/primitives
- **Discriminated unions** for error states

### State Management (Mobile)
- **Zustand** with persist middleware for user session
- Two stores: `useUserStore` (auth), `useEssayStore` (essay draft)
- Token stored in `globalThis.__token__` for API interceptor access

### API Patterns (Mobile)
- **Axios** with request/response interceptors
- Bearer token injection from global token
- 401 handling clears global token

### API Patterns (Server)
- **Express** with standard middleware (helmet, cors, morgan)
- **Response wrapper**: `sendSuccess(res, data)` helper
- **Error handling**: Centralized error middleware, typed errors
- **AI Services**: Zhipu (GLM) for grading, Ark (火山引擎) for OCR

### Git Workflow
- Conventional commits: `feat:`, `fix:`, `docs:`, `refactor:`
- Feature branches: `feat/user-auth`, `fix/login-bug`

## ANTI-PATTERNS (THIS PROJECT)

- ❌ **Don't commit `dist/`** - Build artifacts should be generated by CI
- ❌ **Don't use barrel exports** in shared for tree-shakable libraries
- ❌ **Don't suppress TypeScript errors** (`as any`, `@ts-ignore`)
- ❌ **Don't leave empty catch blocks** - always log or handle errors
- ❌ **Don't mix naming styles**: components PascalCase, files kebab-case

## COMMANDS

```bash
# Install all workspaces
npm install --workspaces

# Development
npm run dev:server              # Backend only
npm run dev:mobile              # Mobile only (Expo)
npm run dev                     # Both (concurrently)

# Build
npm run build --workspaces      # TypeScript compilation

# Lint & Typecheck
npm run lint --workspaces
npm run typecheck               # Per-workspace

# Test
npm test --workspaces           # Server uses Vitest
```

## UNIQUE STYLES

1. **Global token pattern**: `globalThis.__token__` for API client access
2. **Dual AI services**: Zhipu (批改) + Ark (OCR)
3. **Typed API responses**: `ApiResponse<T>` wrapper with success/data/error
4. **Zustand + AsyncStorage**: Persistent user session

## NOTES

- **No CI/CD configured** - Consider adding `.github/workflows/ci.yml`
- **Root tsconfig.base.json** missing from filesystem (mentioned in README)
- **Shared dist committed** - Review if intentional
- **Server uses Vitest** for testing (no config file found)
- **Mobile uses Expo Router** with file-based routing in `app/(tabs)/`

## CROSS-CUTTING CONCERNS

- **Authentication**: JWT via `Authorization: Bearer` header
- **Error codes**: `MISSING_CONTENT`, `MISSING_URL`, `NOT_FOUND`, `INTERNAL_ERROR`
- **AI prompts**: English essay grading with Chinese instructions
- **Image upload**: OCR accepts imageUrl, not multipart
